Index: jackrabbit-jcr-commons/pom.xml
===================================================================
*** jackrabbit-jcr-commons/pom.xml	(revision 1094606)
--- jackrabbit-jcr-commons/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jcr-commons</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jcr-commons</artifactId>
Index: jackrabbit-core/src/test/java/org/apache/jackrabbit/api/security/user/UserManagerSearchTest.java
===================================================================
*** jackrabbit-core/src/test/java/org/apache/jackrabbit/api/security/user/UserManagerSearchTest.java	(revision 1094606)
--- jackrabbit-core/src/test/java/org/apache/jackrabbit/api/security/user/UserManagerSearchTest.java	(working copy)
***************
*** 782,792 ****
          Set<? extends T> set1 = toSet(it1);
          Set<? extends T> set2 = toSet(it2);
  
!         Set<? super T> missing = new HashSet<T>();
          missing.addAll(set2);
          missing.removeAll(set1);
  
!         Set<? super T> excess = new HashSet<T>();
          excess.addAll(set1);
          excess.removeAll(set2);
  
--- 782,792 ----
          Set<? extends T> set1 = toSet(it1);
          Set<? extends T> set2 = toSet(it2);
  
!         Set missing = new HashSet<T>();
          missing.addAll(set2);
          missing.removeAll(set1);
  
!         Set excess = new HashSet<T>();
          excess.addAll(set1);
          excess.removeAll(set2);
  
Index: jackrabbit-core/src/main/java/org/apache/jackrabbit/core/SessionImpl.java
===================================================================
*** jackrabbit-core/src/main/java/org/apache/jackrabbit/core/SessionImpl.java	(revision 1094606)
--- jackrabbit-core/src/main/java/org/apache/jackrabbit/core/SessionImpl.java	(working copy)
***************
*** 16,21 ****
--- 16,25 ----
   */
  package org.apache.jackrabbit.core;
  
+ import org.apache.jackrabbit.core.observation.EventStateCollectionFactory;
+ import org.apache.jackrabbit.core.state.ItemStateCacheFactory;
+ import org.apache.jackrabbit.core.state.LocalItemStateManager;
+ import org.apache.jackrabbit.core.state.SharedItemStateManager;
  import static org.apache.jackrabbit.core.ItemValidator.CHECK_CHECKED_OUT;
  import static org.apache.jackrabbit.core.ItemValidator.CHECK_CONSTRAINTS;
  import static org.apache.jackrabbit.core.ItemValidator.CHECK_HOLD;
***************
*** 1263,1266 ****
--- 1267,1273 ----
          }
      }
  
+     public LocalItemStateManager createItemStateManager(RepositoryContext repositoryContext, WorkspaceImpl workspace, SharedItemStateManager sharedStateMgr, EventStateCollectionFactory factory, String attribute, ItemStateCacheFactory cacheFactory) {
+         return LocalItemStateManager.createInstance(sharedStateMgr, factory, cacheFactory);
+     }
  }
Index: jackrabbit-core/src/main/java/org/apache/jackrabbit/core/XASessionImpl.java
===================================================================
*** jackrabbit-core/src/main/java/org/apache/jackrabbit/core/XASessionImpl.java	(revision 1094606)
--- jackrabbit-core/src/main/java/org/apache/jackrabbit/core/XASessionImpl.java	(working copy)
***************
*** 19,25 ****
--- 19,30 ----
  import org.apache.jackrabbit.api.XASession;
  import org.apache.jackrabbit.core.config.WorkspaceConfig;
  import org.apache.jackrabbit.core.lock.XALockManager;
+ import org.apache.jackrabbit.core.observation.EventStateCollectionFactory;
  import org.apache.jackrabbit.core.security.authentication.AuthContext;
+ import org.apache.jackrabbit.core.session.SessionContext;
+ import org.apache.jackrabbit.core.state.ItemStateCacheFactory;
+ import org.apache.jackrabbit.core.state.LocalItemStateManager;
+ import org.apache.jackrabbit.core.state.SharedItemStateManager;
  import org.apache.jackrabbit.core.state.XAItemStateManager;
  import org.apache.jackrabbit.core.version.InternalVersionManager;
  import org.apache.jackrabbit.core.version.InternalXAVersionManager;
***************
*** 406,409 ****
--- 411,419 ----
              return s1.equals(s2);
          }
      }
+ 
+     @Override
+     public LocalItemStateManager createItemStateManager(RepositoryContext repositoryContext, WorkspaceImpl workspace, SharedItemStateManager sharedStateMgr, EventStateCollectionFactory factory, String attributeName, ItemStateCacheFactory cacheFactory) {
+             return XAItemStateManager.createInstance(sharedStateMgr, factory, attributeName, cacheFactory);
+     }
  }
Index: jackrabbit-core/src/main/java/org/apache/jackrabbit/core/WorkspaceImpl.java
===================================================================
*** jackrabbit-core/src/main/java/org/apache/jackrabbit/core/WorkspaceImpl.java	(revision 1094606)
--- jackrabbit-core/src/main/java/org/apache/jackrabbit/core/WorkspaceImpl.java	(working copy)
***************
*** 885,899 ****
          SharedItemStateManager sism = getSharedItemStateManager();
          ItemStateCacheFactory iscf =
              context.getRepositoryContext().getItemStateCacheFactory();
! 
!         // FIXME We should be able to avoid the instanceof operator here
!         if (context.getSessionImpl() instanceof XASessionImpl) {
!             return XAItemStateManager.createInstance(
!                     sism, this, null, iscf);
!         } else {
!             return LocalItemStateManager.createInstance(
!                     sism, this, iscf);
!         }
  
      }
  
--- 885,891 ----
          SharedItemStateManager sism = getSharedItemStateManager();
          ItemStateCacheFactory iscf =
              context.getRepositoryContext().getItemStateCacheFactory();
!         return context.getSessionImpl().createItemStateManager(this.context.getRepositoryContext(), this, sism, this, null, iscf);
  
      }
  
Index: jackrabbit-core/src/main/java/org/apache/jackrabbit/core/ItemSaveOperation.java
===================================================================
*** jackrabbit-core/src/main/java/org/apache/jackrabbit/core/ItemSaveOperation.java	(revision 1094606)
--- jackrabbit-core/src/main/java/org/apache/jackrabbit/core/ItemSaveOperation.java	(working copy)
***************
*** 259,265 ****
              // update operation succeeded
              succeeded = true;
          } catch (StaleItemStateException e) {
!             throw new InvalidItemStateException(e.getMessage());
          } catch (ItemStateException e) {
              throw new RepositoryException(
                      "Unable to update item: " + this, e);
--- 259,265 ----
              // update operation succeeded
              succeeded = true;
          } catch (StaleItemStateException e) {
!             throw new InvalidItemStateException(e.getMessage(), e);
          } catch (ItemStateException e) {
              throw new RepositoryException(
                      "Unable to update item: " + this, e);
Index: jackrabbit-core/src/main/java/org/apache/jackrabbit/core/BatchedItemOperations.java
===================================================================
*** jackrabbit-core/src/main/java/org/apache/jackrabbit/core/BatchedItemOperations.java	(revision 1094606)
--- jackrabbit-core/src/main/java/org/apache/jackrabbit/core/BatchedItemOperations.java	(working copy)
***************
*** 524,538 ****
              throw new RepositoryException(msg);
          }
  
-         HierarchyManagerImpl hierMgr = (HierarchyManagerImpl) this.hierMgr;
-         if (hierMgr.isShareAncestor(target.getNodeId(), destParent.getNodeId())) {
-             String msg =
-                 safeGetJCRPath(destPath) + ": invalid destination path"
-                 + " (share cycle detected)";
-             log.debug(msg);
-             throw new RepositoryException(msg);
-         }
- 
          // 2. check if target state can be removed from old/added to new parent
  
          checkRemoveNode(target, srcParent.getNodeId(),
--- 524,529 ----
Index: jackrabbit-core/src/main/java/org/apache/jackrabbit/core/state/SharedItemStateManager.java
===================================================================
*** jackrabbit-core/src/main/java/org/apache/jackrabbit/core/state/SharedItemStateManager.java	(revision 1094606)
--- jackrabbit-core/src/main/java/org/apache/jackrabbit/core/state/SharedItemStateManager.java	(working copy)
***************
*** 1054,1060 ****
                          // same UUID, i.e. the node is still referenceable.
                          if (refs.hasReferences() && !local.has(targetId)) {
                              String msg = node.getNodeId()
!                                     + ": the node cannot be removed because it is still being referenced.";
                              log.debug(msg);
                              throw new ReferentialIntegrityException(msg);
                          }
--- 1054,1064 ----
                          // same UUID, i.e. the node is still referenceable.
                          if (refs.hasReferences() && !local.has(targetId)) {
                              String msg = node.getNodeId()
!                                     + ": the node cannot be removed because it is still being referenced from";
!                             for(Iterator refsIter=refs.getReferences().iterator(); refsIter.hasNext(); ) {
!                                 PropertyId propertyId = (PropertyId) refsIter.next();
!                                 msg += " " + propertyId;
!                             }
                              log.debug(msg);
                              throw new ReferentialIntegrityException(msg);
                          }
Index: jackrabbit-core/src/main/java/org/apache/jackrabbit/core/observation/EventConsumer.java
===================================================================
*** jackrabbit-core/src/main/java/org/apache/jackrabbit/core/observation/EventConsumer.java	(revision 1094606)
--- jackrabbit-core/src/main/java/org/apache/jackrabbit/core/observation/EventConsumer.java	(working copy)
***************
*** 302,308 ****
       * @throws RepositoryException
       */
      private boolean canRead(EventState eventState) throws RepositoryException {
!         Path targetPath = pathFactory.create(eventState.getParentPath(), eventState.getChildRelPath().getName(), eventState.getChildRelPath().getNormalizedIndex(), true);
!         return session.getAccessManager().canRead(targetPath, null);
      }
  }
--- 302,307 ----
       * @throws RepositoryException
       */
      private boolean canRead(EventState eventState) throws RepositoryException {
!         return true;
      }
  }
Index: jackrabbit-core/pom.xml
===================================================================
*** jackrabbit-core/pom.xml	(revision 1094606)
--- jackrabbit-core/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-core</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-core</artifactId>
***************
*** 202,229 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-api</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5</version>
        <classifier />
      </dependency>
        <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5</version>
        <classifier>tests</classifier>
        <scope>test</scope>
      </dependency>
--- 202,229 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-api</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5-h3</version>
        <classifier />
      </dependency>
        <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5-h3</version>
        <classifier>tests</classifier>
        <scope>test</scope>
      </dependency>
***************
*** 269,275 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5</version>
        <optional>true</optional>
      </dependency>
      <dependency>
--- 269,275 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5-h3</version>
        <optional>true</optional>
      </dependency>
      <dependency>
Index: jackrabbit-standalone/pom.xml
===================================================================
*** jackrabbit-standalone/pom.xml	(revision 1094606)
--- jackrabbit-standalone/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-standalone</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-standalone</artifactId>
***************
*** 71,89 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-webapp</artifactId>
!       <version>2.2.5</version>
        <type>war</type>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-webapp</artifactId>
!       <version>2.2.5</version>
        <type>jar</type>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2dav</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.mortbay.jetty</groupId>
--- 71,89 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-webapp</artifactId>
!       <version>2.2.5-h3</version>
        <type>war</type>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-webapp</artifactId>
!       <version>2.2.5-h3</version>
        <type>jar</type>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2dav</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.mortbay.jetty</groupId>
Index: jackrabbit-parent/pom.xml
===================================================================
*** jackrabbit-parent/pom.xml	(revision 1094606)
--- jackrabbit-parent/pom.xml	(working copy)
***************
*** 33,39 ****
  
    <artifactId>jackrabbit-parent</artifactId>
    <name>Jackrabbit Parent POM</name>
!   <version>2.2.5</version>
    <packaging>pom</packaging>
    <issueManagement>
      <system>Jira</system>
--- 33,39 ----
  
    <artifactId>jackrabbit-parent</artifactId>
    <name>Jackrabbit Parent POM</name>
!   <version>2.2.5-h3</version>
    <packaging>pom</packaging>
    <issueManagement>
      <system>Jira</system>
***************
*** 46,54 ****
--- 46,79 ----
      <jetty.version>6.1.22</jetty.version>
      <tika.version>0.8</tika.version>
    </properties>
+    <distributionManagement>
+      <repository>
+        <id>hippo-maven2</id>
+        <url>https://maven.onehippo.com/content/repositories/releases/</url>
+      </repository>
+    </distributionManagement>
+  
  
    <build>
+      <extensions>
+        <extension>
+          <groupId>org.apache.maven.wagon</groupId>
+          <artifactId>wagon-ftp</artifactId>
+          <version>1.0-alpha-6</version>
+        </extension>
+      </extensions>
      <plugins>
+       <plugin>
+          <artifactId>maven-source-plugin</artifactId>
+          <executions>
+            <execution>
+              <id>attach-sources</id>
+              <goals>
+                <goal>jar</goal>
+              </goals>
+            </execution>
+          </executions>
+        </plugin>
        <!-- JCR-2087: Upgrade to Java 5 as the base platform -->
        <plugin>
          <artifactId>maven-compiler-plugin</artifactId>
Index: jackrabbit-jcr-client/pom.xml
===================================================================
*** jackrabbit-jcr-client/pom.xml	(revision 1094606)
--- jackrabbit-jcr-client/pom.xml	(working copy)
***************
*** 26,32 ****
      <parent>
          <groupId>org.apache.jackrabbit</groupId>
          <artifactId>jackrabbit-parent</artifactId>
!         <version>2.2.5</version>
          <relativePath>../jackrabbit-parent/pom.xml</relativePath>
      </parent>
      <artifactId>jackrabbit-jcr-client</artifactId>
--- 26,32 ----
      <parent>
          <groupId>org.apache.jackrabbit</groupId>
          <artifactId>jackrabbit-parent</artifactId>
!         <version>2.2.5-h3</version>
          <relativePath>../jackrabbit-parent/pom.xml</relativePath>
      </parent>
      <artifactId>jackrabbit-jcr-client</artifactId>
***************
*** 91,127 ****
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-jcr2spi</artifactId>
!             <version>2.2.5</version>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-spi2dav</artifactId>
!             <version>2.2.5</version>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-spi2jcr</artifactId>
!             <version>2.2.5</version>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-core</artifactId>
!             <version>2.2.5</version>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-spi-commons</artifactId>
!             <version>2.2.5</version>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-spi</artifactId>
!             <version>2.2.5</version>
              <scope>test</scope>
          </dependency>
          <dependency>
--- 91,127 ----
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-jcr2spi</artifactId>
!             <version>2.2.5-h3</version>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-spi2dav</artifactId>
!             <version>2.2.5-h3</version>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-spi2jcr</artifactId>
!             <version>2.2.5-h3</version>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-core</artifactId>
!             <version>2.2.5-h3</version>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-spi-commons</artifactId>
!             <version>2.2.5-h3</version>
              <scope>test</scope>
          </dependency>
          <dependency>
              <groupId>org.apache.jackrabbit</groupId>
              <artifactId>jackrabbit-spi</artifactId>
!             <version>2.2.5-h3</version>
              <scope>test</scope>
          </dependency>
          <dependency>
Index: jackrabbit-jcr2dav/pom.xml
===================================================================
*** jackrabbit-jcr2dav/pom.xml	(revision 1094606)
--- jackrabbit-jcr2dav/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jcr2dav</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jcr2dav</artifactId>
***************
*** 138,174 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2spi</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi2dav</artifactId>
!       <version>2.2.5</version>
      </dependency>
  
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
      <dependency>
         <groupId>org.apache.jackrabbit</groupId>
         <artifactId>jackrabbit-jcr2spi</artifactId>
!        <version>2.2.5</version>
         <classifier>tests</classifier>
         <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-server</artifactId>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
      <dependency>
--- 138,174 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2spi</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi2dav</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
  
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
      <dependency>
         <groupId>org.apache.jackrabbit</groupId>
         <artifactId>jackrabbit-jcr2spi</artifactId>
!        <version>2.2.5-h3</version>
         <classifier>tests</classifier>
         <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-server</artifactId>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
      <dependency>
Index: jackrabbit-spi/pom.xml
===================================================================
*** jackrabbit-spi/pom.xml	(revision 1094606)
--- jackrabbit-spi/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-spi</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-spi</artifactId>
Index: jackrabbit-jca/pom.xml
===================================================================
*** jackrabbit-jca/pom.xml	(revision 1094606)
--- jackrabbit-jca/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jca</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jca</artifactId>
***************
*** 108,114 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.slf4j</groupId>
--- 108,114 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.slf4j</groupId>
Index: jackrabbit-jcr-servlet/pom.xml
===================================================================
*** jackrabbit-jcr-servlet/pom.xml	(revision 1094606)
--- jackrabbit-jcr-servlet/pom.xml	(working copy)
***************
*** 22,28 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
  
--- 22,28 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
  
***************
*** 48,65 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-rmi</artifactId>
!       <version>2.2.5</version>
        <optional>true</optional>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5</version>
        <optional>true</optional>
      </dependency>
    </dependencies>
--- 48,65 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-rmi</artifactId>
!       <version>2.2.5-h3</version>
        <optional>true</optional>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5-h3</version>
        <optional>true</optional>
      </dependency>
    </dependencies>
Index: pom.xml
===================================================================
*** pom.xml	(revision 1094606)
--- pom.xml	(working copy)
***************
*** 27,33 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>jackrabbit-parent/pom.xml</relativePath>
    </parent>
  
--- 27,33 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>jackrabbit-parent/pom.xml</relativePath>
    </parent>
  
Index: jackrabbit-jcr-rmi/pom.xml
===================================================================
*** jackrabbit-jcr-rmi/pom.xml	(revision 1094606)
--- jackrabbit-jcr-rmi/pom.xml	(working copy)
***************
*** 22,28 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
  
--- 22,28 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
  
***************
*** 654,660 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!         <version>2.2.5</version>
        <scope>provided</scope>
      </dependency>
      
--- 654,660 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!         <version>2.2.5-h3</version>
        <scope>provided</scope>
      </dependency>
      
***************
*** 662,668 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-api</artifactId>
!         <version>2.2.5</version>
        <scope>provided</scope>
      </dependency>
  
--- 662,668 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-api</artifactId>
!         <version>2.2.5-h3</version>
        <scope>provided</scope>
      </dependency>
  
***************
*** 675,687 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
      <dependency>
--- 675,687 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
      <dependency>
Index: jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/PathBuilder.java
===================================================================
*** jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/PathBuilder.java	(revision 1094606)
--- jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/PathBuilder.java	(working copy)
***************
*** 16,21 ****
--- 16,22 ----
   */
  package org.apache.jackrabbit.spi.commons.name;
  
+ import javax.jcr.RepositoryException;
  import org.apache.jackrabbit.spi.Name;
  import org.apache.jackrabbit.spi.Path;
  import org.apache.jackrabbit.spi.PathFactory;
***************
*** 89,97 ****
       */
      public void addRoot() {
          if (path != null) {
!             path = RootPath.ROOT_PATH.resolve(path);
          } else {
!             path = RootPath.ROOT_PATH;
          }
      }
  
--- 90,98 ----
       */
      public void addRoot() {
          if (path != null) {
!             path = ((Path)factory.getRootElement()).resolve(path);
          } else {
!             path = (Path) factory.getRootElement();
          }
      }
  
***************
*** 172,178 ****
       * @param index
       */
      public void addLast(Name name, int index) {
!         path = new NamePath(path, name, index);
      }
  
      /**
--- 173,183 ----
       * @param index
       */
      public void addLast(Name name, int index) {
!         try {
!             path = factory.create(path, name, index, false);
!         } catch(RepositoryException ex) {
!             // because normalize argument to create method is false, will not occur
!         }
      }
  
      /**
Index: jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/PathFactoryImpl.java
===================================================================
*** jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/PathFactoryImpl.java	(revision 1094606)
--- jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/PathFactoryImpl.java	(working copy)
***************
*** 124,129 ****
--- 124,131 ----
      public Path create(Path.Element element) {
          if (element.denotesCurrent()) {
              return CurrentPath.CURRENT_PATH;
+         } else if (element.denotesIdentifier() && element.denotesName()) {
+             return new CargoNamePath(null, element.getName(), element.getIdentifier());
          } else if (element.denotesIdentifier()) {
              return new IdentifierPath(element.getIdentifier());
          } else if (element.denotesName()) {
***************
*** 146,151 ****
--- 148,155 ----
          for (Path.Element element : elements) {
              if (element.denotesCurrent()) {
                  path = new CurrentPath(path);
+             } else if (element.denotesName() && element.denotesIdentifier()) {
+                 path = new CargoNamePath(path, element.getName(), element.getIdentifier());
              } else if (element.denotesIdentifier()) {
                  if (path != null) {
                      throw new IllegalArgumentException();
***************
*** 268,273 ****
--- 272,281 ----
          if (pos1 == -1) {
              throw new IllegalArgumentException("invalid PathElement literal: " + elementString + " (missing ']')");
          }
+         if(elementString.charAt(pos+1)=='[') {
+              String argument = elementString.substring(pos + 2, pos1);
+              return new CargoNamePath(null, name, argument);
+         }
          try {
              int index = Integer.valueOf(elementString.substring(pos + 1, pos1));
              if (index < 1) {
Index: jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/CargoNamePath.java
===================================================================
*** jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/CargoNamePath.java	(revision 0)
--- jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/CargoNamePath.java	(revision 0)
***************
*** 0 ****
--- 1,175 ----
+ /*
+  * Licensed to the Apache Software Foundation (ASF) under one or more
+  * contributor license agreements.  See the NOTICE file distributed with
+  * this work for additional information regarding copyright ownership.
+  * The ASF licenses this file to You under the Apache License, Version 2.0
+  * (the "License"); you may not use this file except in compliance with
+  * the License.  You may obtain a copy of the License at
+  *
+  *      http://www.apache.org/licenses/LICENSE-2.0
+  *
+  * Unless required by applicable law or agreed to in writing, software
+  * distributed under the License is distributed on an "AS IS" BASIS,
+  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+  * See the License for the specific language governing permissions and
+  * limitations under the License.
+  */
+ package org.apache.jackrabbit.spi.commons.name;
+ 
+ import javax.jcr.RepositoryException;
+ 
+ import org.apache.jackrabbit.spi.Name;
+ import org.apache.jackrabbit.spi.Path;
+ 
+ public class CargoNamePath extends RelativePath {
+ 
+     /** Serial version UID */
+     private static final long serialVersionUID = -2887665244213430950L;
+ 
+     /**
+      * Name of the last path element.
+      */
+     private final Name name;
+ 
+     /**
+      * Optional index of the last path element. Set to
+      * {@link Path#INDEX_UNDEFINED} if not explicitly specified,
+      * otherwise contains the 1-based index.
+      */
+     private final int index;
+ 
+     private final String argument;
+ 
+     public CargoNamePath(Path parent, Name name, String argument) {
+         super(parent);
+         assert name != null;
+         this.name = name;
+         this.index = 0;
+         this.argument = argument;
+     }
+ 
+     protected int getDepthModifier() {
+         return 1;
+     }
+ 
+     protected Path getParent() throws RepositoryException {
+         if (parent != null) {
+             return parent;
+         } else {
+             return new CurrentPath(null);
+         }
+     }
+ 
+     protected String getElementString() {
+         if (index > Path.INDEX_DEFAULT) {
+             return name + "[" + index + "]";
+         } else {
+             return name.toString();
+         }
+     }
+ 
+     public Name getName() {
+         return name;
+     }
+ 
+     @Override
+     public int getIndex() {
+         return Path.INDEX_DEFAULT;
+     }
+ 
+     @Override
+     public String getIdentifier() {
+         return argument;
+         }
+     
+     @Override
+     public boolean denotesIdentifier() {
+         return true;
+     }
+     
+     @Override
+     public String getString() {
+         return name + "[[" + argument + "]]";
+     }
+ 
+     @Override
+     public int getNormalizedIndex() {
+         return Path.INDEX_DEFAULT;
+     }
+ 
+     @Override
+     public boolean denotesName() {
+         return true;
+     }
+ 
+     public boolean isCanonical() {
+         return parent != null && parent.isCanonical();
+     }
+ 
+     public boolean isNormalized() {
+         return parent == null
+             || (parent.isNormalized()
+                     && !parent.denotesCurrent());
+     }
+ 
+     public Path getNormalizedPath() throws RepositoryException {
+         if (isNormalized()) {
+             return this;
+         } else {
+             // parent is guaranteed to be !null
+             Path normalized = parent.getNormalizedPath();
+             if (normalized.denotesCurrent()) {
+                 normalized = null; // special case: ./a
+             }
+             return new CargoNamePath(normalized, name, argument);
+         }
+     }
+ 
+     public Path getCanonicalPath() throws RepositoryException {
+         if (isCanonical()) {
+             return this;
+         } else if (parent != null) {
+             return new CargoNamePath(parent.getCanonicalPath(), name, argument);
+         } else {
+             throw new RepositoryException(
+                     "There is no canonical representation of " + this);
+         }
+     }
+ 
+     /**
+      * Returns the last element of this path.
+      *
+      * @return last element of this path
+      */
+     @Override
+     public AbstractPath getLastElement() {
+         if (parent != null) {
+             return new CargoNamePath(null, name, argument);
+         } else {
+             return this;
+         }
+     }
+ 
+     //--------------------------------------------------------------< Object >
+ 
+     @Override
+     public final boolean equals(Object that) {
+         if (this == that) {
+             return true;
+         } else if (that instanceof Path) {
+             Path path = (Path) that;
+             return path.denotesName()
+                 && name.equals(path.getName())
+                 && getNormalizedIndex() == path.getNormalizedIndex()
+                 && super.equals(that);
+         } else {
+             return false;
+         }
+     }
+ 
+     @Override
+     public final int hashCode() {
+         return super.hashCode() * 37 + name.hashCode() + getNormalizedIndex();
+     }
+ 
+ }

Property changes on: jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/CargoNamePath.java
___________________________________________________________________
Added: svn:keywords
   + Id
Added: svn:eol-style
   + native

Index: jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/AbstractPath.java
===================================================================
*** jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/AbstractPath.java	(revision 1094606)
--- jackrabbit-spi-commons/src/main/java/org/apache/jackrabbit/spi/commons/name/AbstractPath.java	(working copy)
***************
*** 133,139 ****
      }
  
      public final Path resolve(Element element) {
!         if (element.denotesName()) {
              return new NamePath(this, element.getName(), element.getIndex());
          } else if (element.denotesParent()) {
              if (isAbsolute() && getDepth() == 0) {
--- 133,141 ----
      }
  
      public final Path resolve(Element element) {
!         if (element.denotesName() && element.denotesIdentifier()) {
!             return new CargoNamePath(this, element.getName(), element.getIdentifier());
!         } else if (element.denotesName()) {
              return new NamePath(this, element.getName(), element.getIndex());
          } else if (element.denotesParent()) {
              if (isAbsolute() && getDepth() == 0) {
***************
*** 164,169 ****
--- 166,173 ----
              return new CurrentPath(this);
          } else if (relative.denotesParent()) {
              return new ParentPath(this);
+         } else if (relative.denotesIdentifier() && relative.denotesName()) {
+             return new CargoNamePath(this, relative.getName(), relative.getIdentifier());
          } else if (relative.denotesName()) {
              return new NamePath(this, relative.getName(), relative.getIndex());
          } else {
Index: jackrabbit-spi-commons/pom.xml
===================================================================
*** jackrabbit-spi-commons/pom.xml	(revision 1094606)
--- jackrabbit-spi-commons/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-spi-commons</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-spi-commons</artifactId>
***************
*** 143,154 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>commons-collections</groupId>
--- 143,154 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>commons-collections</groupId>
Index: jackrabbit-webdav/pom.xml
===================================================================
*** jackrabbit-webdav/pom.xml	(revision 1094606)
--- jackrabbit-webdav/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-webdav</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-webdav</artifactId>
***************
*** 52,58 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.slf4j</groupId>
--- 52,58 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.slf4j</groupId>
Index: jackrabbit-spi2dav/pom.xml
===================================================================
*** jackrabbit-spi2dav/pom.xml	(revision 1094606)
--- jackrabbit-spi2dav/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-spi2dav</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-spi2dav</artifactId>
***************
*** 132,154 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5</version>
        <classifier />
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-webdav</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>javax.jcr</groupId>
--- 132,154 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5-h3</version>
        <classifier />
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-webdav</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>javax.jcr</groupId>
***************
*** 170,189 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2spi</artifactId>
!       <version>2.2.5</version>
        <classifier />
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2spi</artifactId>
!       <version>2.2.5</version>
        <classifier>tests</classifier>
        <scope>test</scope>
      </dependency>
--- 170,189 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2spi</artifactId>
!       <version>2.2.5-h3</version>
        <classifier />
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2spi</artifactId>
!       <version>2.2.5-h3</version>
        <classifier>tests</classifier>
        <scope>test</scope>
      </dependency>
***************
*** 191,197 ****
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
        <classifier>tests</classifier>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
    </dependencies>
--- 191,197 ----
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
        <classifier>tests</classifier>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
    </dependencies>
Index: jackrabbit-api/pom.xml
===================================================================
*** jackrabbit-api/pom.xml	(revision 1094606)
--- jackrabbit-api/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-api</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-api</artifactId>
Index: jackrabbit-jcr2spi/pom.xml
===================================================================
*** jackrabbit-jcr2spi/pom.xml	(revision 1094606)
--- jackrabbit-jcr2spi/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jcr2spi</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jcr2spi</artifactId>
***************
*** 83,105 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <!-- tmp dependency to jackrabbit-api until jsr 283 is released -->
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-api</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <!-- end of tmp dependency -->
      <dependency>
--- 83,105 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <!-- tmp dependency to jackrabbit-api until jsr 283 is released -->
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-api</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <!-- end of tmp dependency -->
      <dependency>
***************
*** 123,129 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
      <dependency>
--- 123,129 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
      <dependency>
Index: jackrabbit-spi2jcr/pom.xml
===================================================================
*** jackrabbit-spi2jcr/pom.xml	(revision 1094606)
--- jackrabbit-spi2jcr/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-spi2jcr</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-spi2jcr</artifactId>
***************
*** 86,110 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5</version>
        <classifier />
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5</version>
        <classifier>tests</classifier>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.slf4j</groupId>
--- 86,110 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5-h3</version>
        <classifier />
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi</artifactId>
!       <version>2.2.5-h3</version>
        <classifier>tests</classifier>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-spi-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.slf4j</groupId>
***************
*** 118,124 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
      <dependency>
--- 118,124 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-tests</artifactId>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
      <dependency>
***************
*** 129,148 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2spi</artifactId>
!       <version>2.2.5</version>
        <classifier>tests</classifier>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2spi</artifactId>
!       <version>2.2.5</version>
        <classifier />
        <scope>test</scope>
      </dependency>
--- 129,148 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2spi</artifactId>
!       <version>2.2.5-h3</version>
        <classifier>tests</classifier>
        <scope>test</scope>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr2spi</artifactId>
!       <version>2.2.5-h3</version>
        <classifier />
        <scope>test</scope>
      </dependency>
Index: jackrabbit-jcr-tests/pom.xml
===================================================================
*** jackrabbit-jcr-tests/pom.xml	(revision 1094606)
--- jackrabbit-jcr-tests/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jcr-tests</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jcr-tests</artifactId>
Index: jackrabbit-webapp/pom.xml
===================================================================
*** jackrabbit-webapp/pom.xml	(revision 1094606)
--- jackrabbit-webapp/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-webapp</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-webapp</artifactId>
***************
*** 46,52 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5</version>
        <exclusions>
          <exclusion>
            <groupId>log4j</groupId>
--- 46,52 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5-h3</version>
        <exclusions>
          <exclusion>
            <groupId>log4j</groupId>
***************
*** 62,78 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-server</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-servlet</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-rmi</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>ch.qos.logback</groupId>
--- 62,78 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-server</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-servlet</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-rmi</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>ch.qos.logback</groupId>
Index: jackrabbit-jcr-server/pom.xml
===================================================================
*** jackrabbit-jcr-server/pom.xml	(revision 1094606)
--- jackrabbit-jcr-server/pom.xml	(working copy)
***************
*** 26,32 ****
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jcr-server</artifactId>
--- 26,32 ----
    <parent>
      <groupId>org.apache.jackrabbit</groupId>
      <artifactId>jackrabbit-parent</artifactId>
!     <version>2.2.5-h3</version>
      <relativePath>../jackrabbit-parent/pom.xml</relativePath>
    </parent>
    <artifactId>jackrabbit-jcr-server</artifactId>
***************
*** 96,107 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-webdav</artifactId>
!       <version>2.2.5</version>
      </dependency>
      <dependency>
        <groupId>org.apache.tika</groupId>
--- 96,107 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-jcr-commons</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-webdav</artifactId>
!       <version>2.2.5-h3</version>
      </dependency>
      <dependency>
        <groupId>org.apache.tika</groupId>
***************
*** 128,134 ****
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5</version>
        <scope>test</scope>
      </dependency>
      <dependency>
--- 128,134 ----
      <dependency>
        <groupId>org.apache.jackrabbit</groupId>
        <artifactId>jackrabbit-core</artifactId>
!       <version>2.2.5-h3</version>
        <scope>test</scope>
      </dependency>
      <dependency>
